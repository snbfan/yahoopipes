<!doctype html>
<html lang="en">
s<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Yahoopipes</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
    <!--<script src="yahoopipes.js"></script>-->
    <script>
        'use strict';
        angular.module('yahoopipes', [])
                .service('pipeService', ['$q', '$http', function ($q,$http) {

                    // jsonp fetch
                    function fetch(pipeId) {
                        var url = 'http://pipes.yahoo.com/pipes/pipe.run?_id=' + pipeId + '&_render=json&_callback=JSON_CALLBACK', deferred = $q.defer();
                        $http.jsonp(url).success(function (data, status, headers, config) {
                            deferred.resolve(data);
                        }).error(function (data, status, headers, config) {
                            deferred.reject(status);
                        });
                        return deferred.promise;
                    }

                    // public API
                    return {
                        fetch: fetch
                    }
                }])
                .controller('main', ['$scope', '$http', '$q', 'pipeService', function($scope, $http, $q, pipeService) {

                    /**
                     *
                     * @type {string}
                     */
                    $scope.yahoopipes = 'PIPES!';

                    /**
                     *
                     * @type {Array} result data container
                     */
                    $scope.pipes = [];

                    /**
                     *
                     * @type {string} error message
                     */
                    $scope.error = '';

                    /**
                     *
                     * @type {boolean} state trigger
                     */
                    $scope.loading = false;

                    /**
                     *
                     * @type {string} pipe id
                     */
                    $scope.pipeId = '74fc14a798efee89310bea2b56f99336';

                    /**
                     * Do a call to yahoo, parses pipes into nice html
                     *
                     * @param param1
                     * @param param2
                     * @returns {boolean}
                     */
                    $scope.getPipes = function() {
                        $scope.loading = true;
                        // fetch some pipes
                        pipeService.fetch($scope.pipeId).then(function(result) {
                            // parse result if success
                            $scope.pipes = result.value.items;
                            $scope.loading = false;
                        }, function(error) {
                            // show error message if failed
                            $scope.error = 'Sorry, we couldn\'t get any pipes.';
                            $scope.loading = false;
                        });
                    }
                }]);
    </script>
</head>

<body ng-app="yahoopipes" ng-cloak>
    <div ng-controller="main">
        <div><button ng-click="getPipes()">{{yahoopipes}}</button></div>
        <br>
        <div>
            {{results}}
        </div>
        <div>{{error}}</div>
    </div>
</body>

</html>